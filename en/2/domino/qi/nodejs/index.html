<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../../../../favicon.png">
        

	<title>Qi - Using NodeJS and LininoIO - GL.iNet Docs</title>

        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">
        <link href="../../../css/extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-108265653-5', 'docs.glinet.com');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="https://www.gl-inet.com" style="padding: 10px"><img src="../../../img/logo.png" style="height:30px"></a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Home <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../..">Home</a>
</li>

                        
                            
<li >
    <a href="../../../service/">Services</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Hardware <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../hardware/ar150/">GL-AR150 Series</a>
</li>

                        
                            
<li >
    <a href="../../../hardware/ar300m/">GL-AR300M Series</a>
</li>

                        
                            
<li >
    <a href="../../../hardware/mt300a/">GL-MT300A</a>
</li>

                        
                            
<li >
    <a href="../../../hardware/mt300n/">GL-MT300N</a>
</li>

                        
                            
<li >
    <a href="../../../hardware/mt300n-v2/">GL-MT300N-V2</a>
</li>

                        
                            
<li >
    <a href="../../../hardware/ar750/">GL-AR750 Series</a>
</li>

                        
                            
<li >
    <a href="../../../hardware/mifi/">GL-MiFi Series</a>
</li>

                        
                            
<li >
    <a href="../../../hardware/usb150/">GL-USB150 (Microuter)</a>
</li>

                        
                            
<li >
    <a href="../../../hardware/b1300/">GL-B1300</a>
</li>

                        
                            
<li >
    <a href="../../../hardware/6416/">GL.iNet6416</a>
</li>

                        
                            
<li >
    <a href="../../../hardware/ar300/">GL-AR300</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Setup <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../setup/first-time_setup/">First-time Setup</a>
</li>

                        
                            
<li >
    <a href="../../../setup/internet_setting/">Internet Settings</a>
</li>

                        
                            
<li >
    <a href="../../../setup/mac_clone/">MAC Clone</a>
</li>

                        
                            
<li >
    <a href="../../../setup/dns/">DNS Setting</a>
</li>

                        
                            
<li >
    <a href="../../../setup/repeater_manager/">Repeater Manager</a>
</li>

                        
                            
<li >
    <a href="../../../setup/lan_ip/">LAN IP</a>
</li>

                        
                            
<li >
    <a href="../../../setup/wifi_setting/">Wi-Fi Settings (AP)</a>
</li>

                        
                            
<li >
    <a href="../../../setup/firmware/">Firmware Upgrading</a>
</li>

                        
                            
<li >
    <a href="../../../setup/modem_manager/">Momdem Manager</a>
</li>

                        
                            
<li >
    <a href="../../../setup/rtc_setting/">RTC Setting</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Development <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../dev/serial/">UART Serial</a>
</li>

                        
                            
<li >
    <a href="../../../dev/uboot/">Advanced Uboot</a>
</li>

                        
                            
<li >
    <a href="../../">Domino Kit</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Application <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../app/ssh/">SSH to the router</a>
</li>

                        
                            
<li >
    <a href="../../../app/openvpn/">OpenVPN Client</a>
</li>

                        
                            
<li >
    <a href="../../../app/tor/">Tor</a>
</li>

                        
                            
<li >
    <a href="../../../app/tether/">EasyTether</a>
</li>

                        
                            
<li >
    <a href="../../../app/ss/">Shadowsocks</a>
</li>

                        
                            
<li >
    <a href="../../../app/wireguard/">WireGuard</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Video <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../video/product_intro/">Product Intro</a>
</li>

                        
                            
<li >
    <a href="../../../video/tutor/">Tutorial</a>
</li>

                        
                            
<li >
    <a href="../../../video/review/">Customer Review</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Troubleshooting <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../troubleshooting/led/">LED Indicator</a>
</li>

                        
                            
<li >
    <a href="../../../troubleshooting/reset/">Repair or Reset</a>
</li>

                        
                            
<li >
    <a href="../../../troubleshooting/debrick/">Debrick via Uboot</a>
</li>

                        
                            
<li >
    <a href="../../../troubleshooting/stop_supporting/">Stop Supporting</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Domino Kit <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../">Getting Started</a>
</li>

                        
                            
<li >
    <a href="../../hardware/core/">Domore Core</a>
</li>

                        
                            
<li >
    <a href="../../pi/">Domino Pi</a>
</li>

                        
                            
<li >
    <a href="../../pi/pi/">Domino Pi Baseboard</a>
</li>

                        
                            
<li >
    <a href="../../pi/single_eth/">Domino Pi - Single Eth board</a>
</li>

                        
                            
<li >
    <a href="../../pi/dual_eth/">Domino Pi - Due Eth board</a>
</li>

                        
                            
<li >
    <a href="../../pi/single_usb/">Domino Pi - Signle USB board</a>
</li>

                        
                            
<li >
    <a href="../../pi/usb_combo/">Domino Pi - 3xUSB+MicroSD combo</a>
</li>

                        
                            
<li >
    <a href="../../pi/i2s/">Domino Pi - I2S board</a>
</li>

                        
                            
<li >
    <a href="../../pi/spi_jtag/">Domino Pi - SPI/JTAG</a>
</li>

                        
                            
<li >
    <a href="../../pi/led/">Domino Pi - LED</a>
</li>

                        
                            
<li >
    <a href="../mini/">Domino Qi Mini</a>
</li>

                        
                            
<li >
    <a href="../base/">Domino Qi baseboard</a>
</li>

                        
                            
<li >
    <a href="../../pi/using/">Pi - Using the firmware</a>
</li>

                        
                            
<li >
    <a href="../../pi/compile/">Pi - Compile firmware</a>
</li>

                        
                            
<li >
    <a href="../../pi/flashing/">Pi - Flashing and debricking</a>
</li>

                        
                            
<li >
    <a href="../../pi/audio/">Pi - Playing Music</a>
</li>

                        
                            
<li >
    <a href="../../pi/serial/">Pi - Working with Serial</a>
</li>

                        
                            
<li >
    <a href="../../pi/spi/">Pi - Debricking using SPI/JTAG board</a>
</li>

                        
                            
<li >
    <a href="../">Qi - Getting Started</a>
</li>

                        
                            
<li >
    <a href="../arduino-yun/">Qi - Using Arduino or Linino Firmware</a>
</li>

                        
                            
<li class="active">
    <a href="./">Qi - Using NodeJS and LininoIO</a>
</li>

                        
                            
<li >
    <a href="../serial/">Qi - Using Serial</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li>
                    <a href="https://docs.gl-inet.com/en/3/"><i class="fa fa-book"></i> Docs 3</a>
                </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#using-nodejs-and-lininoio">Using NodeJS and LininoIO</a></li>
        
            <li><a href="#install-nodejs">Install NodeJS</a></li>
        
            <li><a href="#install-lininoio-the-easy-way">Install LininoIO - The easy way</a></li>
        
            <li><a href="#install-lininoio-the-comprehensive-way">Install LininoIO - The comprehensive way</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="using-nodejs-and-lininoio">Using NodeJS and LininoIO</h1>
<p>Install NodeJS on Domino Qi is very simple. </p>
<h2 id="install-nodejs">Install NodeJS</h2>
<h3 id="1-insert-a-microsd-card">1. Insert a MicroSD card</h3>
<p>Install one MicroSD card to the slot on Domino Qi baseboard first in order to install packages that take a lot of space and use a lot of memory.</p>
<h3 id="2-run-installation-script">2. Run installation script</h3>
<p>Just execute the installation script: <code>/etc/linino/nodeyun_inst_latest.sh</code>, you will be asked to install fdisk first.</p>
<pre><code>$ sh /etc/linino/nodeyun_inst_latest.sh

Fdisk is not installed ! ! ! The script will install the package for you...

Press [Enter] key to install fdisk...

</code></pre>

<p>After install fdisk, relauch the script: <code>/etc/linino/nodeyun_inst_latest.sh</code></p>
<pre><code>#sh /etc/linino/nodeyun_inst_latest.sh
</code></pre>

<p>When you get the prompt</p>
<pre><code>Welcome to Linino Node.Js installation script v13

Linino node.js installation menu

1. Prepare SDCard and install node.js
2. Revert to original settings
3. Exit and reboot
4. Kill all node processes
0. Exit

Choose : 
</code></pre>

<p>choose <code>1</code>,  then you will be promted:</p>
<pre><code>WARNING : All data on your SDCard Would will be erased, are you sure ? (y/n)
</code></pre>

<p>Several software packages will be downloaded and installed. If you meet some errors (e.g. fuser) but the script continues, just continue.</p>
<p>It takes several minutes to install the packages and format the MicroSD card. Then you will be prompt with the menu again:</p>
<pre><code>Linino node.js installation menu

1. Prepare SDCard and install node.js
2. Revert to original settings
3. Exit and reboot
4. Kill all node processes
0. Exit
</code></pre>

<p>Now choose 3 and reboot the system.</p>
<h3 id="3-install-ideino">3. Install ideino</h3>
<p>Now you should already nodejs installed. Check using <code>which</code></p>
<pre><code>root@domino:~# which node
/opt/usr/bin/node
</code></pre>

<p>Let's install extra packages including ideino. This takes several minutes.</p>
<pre><code>opkg update
opkg install ideinoIO -d mnt
npm install -g node-static
npm install node-static enable
</code></pre>

<p>In the default ideinoIO packages, there is no domino_qi layout, create it by copying arduino_yun layout</p>
<pre><code>cd /opt/usr/lib/node_modules/ideino-linino-lib/utils/layouts
cp arduino_yun.json domino_qi.json
</code></pre>

<h2 id="install-lininoio-the-easy-way">Install LininoIO - The easy way</h2>
<p>LinioIO is a framework that let you interact your AVR from openwrt using NodeJS. </p>
<h3 id="check-uboot-environment-variables">Check uboot environment variables</h3>
<p>Before you use LininoIO, you need to check uboot environments first. In OpenWrt, do <code>fw_printenv</code>. If you see the following output, it means that uboot env is not saved. DON'T continue before you save uboot env.</p>
<p><img alt="CRC error" src="https://static.gl-inet.com/docs/en/2.x/domino/qi/src/crc.jpg" /></p>
<p>Now enter uboot and save envirment vairables. You need to use do this using serial as intructed <a href="../serial.html">here</a>.</p>
<p><img alt="Save env" src="https://static.gl-inet.com/docs/en/2.x/domino/qi/src/saveenv.jpg" /></p>
<h3 id="install-lininoio">Install LininoIO</h3>
<p>Then you can reset your board and boot the Linux system. Simply execute <code>lininoio start</code>.</p>
<p>You can revert back and disable LininoIO by just executing <code>lininoio stop</code>.</p>
<p><img alt="LininoIO Stop" src="https://static.gl-inet.com/docs/en/2.x/domino/qi/src/lininoio-stop.png" /></p>
<p><img alt="LininoIO Stop" src="https://static.gl-inet.com/docs/en/2.x/domino/qi/src/lininoio-stop1.png" /></p>
<h2 id="install-lininoio-the-comprehensive-way">Install LininoIO - The comprehensive way</h2>
<h3 id="1-setup-environement-in-openwrt">1. Setup environement in openwrt</h3>
<p>In order to let Linino IO start when system start, you need to set several environment variables in uboot. Type <code>fw_printenv</code> to display the uboot env variables.</p>
<p>If you got the following error message, it means that the uboot env variables are not stored to flash and you need to go to Step 1. - alternative.</p>
<p><img alt="CRC error" src="https://static.gl-inet.com/docs/en/2.x/domino/qi/src/crc.jpg" /></p>
<p>If you saw correct output as shown below, now set the two variables.</p>
<pre><code>root@domino:~# fw_printenv 
bootcmd=bootm 0x9f050000
bootdelay=2
ipaddr=192.168.1.1
serverip=192.168.1.2
bootfile=&quot;firmware.bin&quot;
loadaddr=0x80800000
ncport=6666
uboot_addr=0x9F000000
uboot_name=uboot_for_domino.bin
uboot_size=0x40000
uboot_backup_size=0x40000
lu=if ping $serverip; then mw.b $loadaddr 0xFF $uboot_backup_size &amp;&amp; cp.b $uboot_addr $loadaddr $uboot_backup_size &amp;&amp; tftp $loadaddr $uboot_name &amp;&amp; if itest.l $filesize &lt;= $uboot_size; then erase $uboot_addr +$uboot_backup_size &amp;&amp; cp.b $loadaddr $uboot_addr $uboot_backup_size &amp;&amp; echo OK!; else echo ERROR! Wrong file size!; fi; else echo ERROR! Server not reachable!; fi
firmware_addr=0x9F050000
firmware_name=openwrt-domino.bin
lf=if ping $serverip; then tftp $loadaddr $firmware_name &amp;&amp; erase $firmware_addr +$filesize &amp;&amp; cp.b $loadaddr $firmware_addr $filesize &amp;&amp; echo OK!; else echo ERROR! Server not reachable!; fi
lc=tftp 0x81000000 config.bin &amp;&amp;cp.b 0x9fff1000 0x80060000 0xf000 &amp;&amp; cp.b 0x81000000 0x80060002 0x06 &amp;&amp;erase 0x9fff0000 +0x10000 &amp;&amp; cp.b 0x81000000 0x9fff0000 $filesize &amp;&amp; cp.b 0x80060000 0x9fff1000 0xf000
ethact=eth0
stdin=serial
stdout=serial
stderr=serial
bootargs=console=spicons,250000 board=domino root=31:03 rootfstype=squashfs,jffs2 noinitrd mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env),1280k(kernel),14656k(rootfs),64k(nvram),64k(art)ro,15936k@0x50000(firmware)
baudrate=250000
</code></pre>

<p>Now use <code>fw_setenv</code> to set bootargs and baudrate and reboot your openwrt.</p>
<pre><code>fw_setenv bootargs &quot;console=spicons,115200 board=domino root=31:03 rootfstype=squashfs,jffs2 noinitrd mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env),1280k(kernel),14656k(rootfs),64k(nvram),64k(art)ro,15936k@0x50000(firmware)&quot;
fw_setenv baudrate 250000
</code></pre>

<h3 id="1-alternative-setup-environement-in-uboot">1. - alternative. Setup environement in uboot</h3>
<p>If your step 1 cannot be done because uboot env is not readable, you need to do this in uboot console. First you need to have the AVR serial installed, if not, by doing <code>run-avrdude /etc/linino/YunSerialTerminal.hex</code></p>
<pre><code>run-avrdude /etc/linino/YunSerialTerminal.hex
</code></pre>

<p>After avr is flashed, you need to enter uboot console. 
First connect power to the MicroUSB connect of Domino Qi Mini, not Dimono Qi baseboard. Your windows will recognize the device as Arduino Yun. 
1. Use putty to connect to the comm port. 
2. Press the Openwrt Reset button on Domino Qi Mini
3. type "gl" quickly once you see the uboot prompt, and you will enter the uboot console.
4. execut the change env using <code>setenv</code> and <code>saveenv</code> then <code>reset</code> your board</p>
<pre><code>setenv bootargs console=ttyATH0,250000 board=domino root=31:03 rootfstype=squashfs,jffs2 noinitrd mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env),1280k(kernel),14656k(rootfs),64k(nvram),64k(art)ro,15936k@0x50000(firmware)
setenv baudrate 250000
saveenv
reset
</code></pre>

<h3 id="2-flash-avr">2. Flash AVR</h3>
<p>You need to flash the correct hex to AVR: <code>run-avrdude /etc/linino/bathos-yun.hex</code></p>
<pre><code>run-avrdude /etc/linino/bathos-yun.hex
</code></pre>

<p>Attention: You may got error when flashing in the verification step, just ignore it. </p>
<h3 id="3-reboot">3. Reboot</h3>
<p>You need to reboot your system to let the system auto-detect the settings and run the LininoIO framework.
Just to check if it is running succefully, do a <code>ps</code> to see if there are many processes named mcuio_irq. 
If you cannot see them, try <code>/etc/init.d/mcuio enable</code> <code>/etc/init.d/mcuio start</code></p>
<pre><code>/etc/init.d/mcuio enable
/etc/init.d/mcuio start

</code></pre>

<p><img alt="MCUIO" src="https://static.gl-inet.com/docs/en/2.x/domino/qi/src/mcuio.png" /></p>
<div id="disqus_thread"></div>
<script>

/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables */
/*
var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//glinet.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
                <p><a href='https://www.gl-inet.com/'> GL Technologies</a> 2019</p>
            
        </footer>

        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>var base_url = '../../..';</script>
        <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
        <script src="../../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
