<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../../../../favicon.png">
        

	<title>Pi - Compile firmware - GL.iNet Docs</title>

        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">
        <link href="../../../css/extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-108265653-5', 'docs.glinet.com');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="https://www.gl-inet.com" style="padding: 10px"><img src="../../../img/logo.png" style="height:30px"></a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Home <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../..">Home</a>
</li>

                        
                            
<li >
    <a href="../../../service/">Services</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Hardware <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../hardware/ar150/">GL-AR150 Series</a>
</li>

                        
                            
<li >
    <a href="../../../hardware/ar300m/">GL-AR300M Series</a>
</li>

                        
                            
<li >
    <a href="../../../hardware/mt300a/">GL-MT300A</a>
</li>

                        
                            
<li >
    <a href="../../../hardware/mt300n/">GL-MT300N</a>
</li>

                        
                            
<li >
    <a href="../../../hardware/mt300n-v2/">GL-MT300N-V2</a>
</li>

                        
                            
<li >
    <a href="../../../hardware/ar750/">GL-AR750 Series</a>
</li>

                        
                            
<li >
    <a href="../../../hardware/mifi/">GL-MiFi Series</a>
</li>

                        
                            
<li >
    <a href="../../../hardware/usb150/">GL-USB150 (Microuter)</a>
</li>

                        
                            
<li >
    <a href="../../../hardware/b1300/">GL-B1300</a>
</li>

                        
                            
<li >
    <a href="../../../hardware/6416/">GL.iNet6416</a>
</li>

                        
                            
<li >
    <a href="../../../hardware/ar300/">GL-AR300</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Setup <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../setup/first-time_setup/">First-time Setup</a>
</li>

                        
                            
<li >
    <a href="../../../setup/internet_setting/">Internet Settings</a>
</li>

                        
                            
<li >
    <a href="../../../setup/mac_clone/">MAC Clone</a>
</li>

                        
                            
<li >
    <a href="../../../setup/dns/">DNS Setting</a>
</li>

                        
                            
<li >
    <a href="../../../setup/repeater_manager/">Repeater Manager</a>
</li>

                        
                            
<li >
    <a href="../../../setup/lan_ip/">LAN IP</a>
</li>

                        
                            
<li >
    <a href="../../../setup/wifi_setting/">Wi-Fi Settings (AP)</a>
</li>

                        
                            
<li >
    <a href="../../../setup/firmware/">Firmware Upgrading</a>
</li>

                        
                            
<li >
    <a href="../../../setup/modem_manager/">Momdem Manager</a>
</li>

                        
                            
<li >
    <a href="../../../setup/rtc_setting/">RTC Setting</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Development <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../dev/serial/">UART Serial</a>
</li>

                        
                            
<li >
    <a href="../../../dev/uboot/">Advanced Uboot</a>
</li>

                        
                            
<li >
    <a href="../../">Domino Kit</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Application <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../app/ssh/">SSH to the router</a>
</li>

                        
                            
<li >
    <a href="../../../app/openvpn/">OpenVPN Client</a>
</li>

                        
                            
<li >
    <a href="../../../app/tor/">Tor</a>
</li>

                        
                            
<li >
    <a href="../../../app/tether/">EasyTether</a>
</li>

                        
                            
<li >
    <a href="../../../app/ss/">Shadowsocks</a>
</li>

                        
                            
<li >
    <a href="../../../app/wireguard/">WireGuard</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Video <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../video/product_intro/">Product Intro</a>
</li>

                        
                            
<li >
    <a href="../../../video/tutor/">Tutorial</a>
</li>

                        
                            
<li >
    <a href="../../../video/review/">Customer Review</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Troubleshooting <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../troubleshooting/led/">LED Indicator</a>
</li>

                        
                            
<li >
    <a href="../../../troubleshooting/reset/">Repair or Reset</a>
</li>

                        
                            
<li >
    <a href="../../../troubleshooting/debrick/">Debrick via Uboot</a>
</li>

                        
                            
<li >
    <a href="../../../troubleshooting/stop_supporting/">Stop Supporting</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Domino Kit <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../">Getting Started</a>
</li>

                        
                            
<li >
    <a href="../../hardware/core/">Domore Core</a>
</li>

                        
                            
<li >
    <a href="../">Domino Pi</a>
</li>

                        
                            
<li >
    <a href="../pi/">Domino Pi Baseboard</a>
</li>

                        
                            
<li >
    <a href="../single_eth/">Domino Pi - Single Eth board</a>
</li>

                        
                            
<li >
    <a href="../dual_eth/">Domino Pi - Due Eth board</a>
</li>

                        
                            
<li >
    <a href="../single_usb/">Domino Pi - Signle USB board</a>
</li>

                        
                            
<li >
    <a href="../usb_combo/">Domino Pi - 3xUSB+MicroSD combo</a>
</li>

                        
                            
<li >
    <a href="../i2s/">Domino Pi - I2S board</a>
</li>

                        
                            
<li >
    <a href="../spi_jtag/">Domino Pi - SPI/JTAG</a>
</li>

                        
                            
<li >
    <a href="../led/">Domino Pi - LED</a>
</li>

                        
                            
<li >
    <a href="../../qi/mini/">Domino Qi Mini</a>
</li>

                        
                            
<li >
    <a href="../../qi/base/">Domino Qi baseboard</a>
</li>

                        
                            
<li >
    <a href="../using/">Pi - Using the firmware</a>
</li>

                        
                            
<li class="active">
    <a href="./">Pi - Compile firmware</a>
</li>

                        
                            
<li >
    <a href="../flashing/">Pi - Flashing and debricking</a>
</li>

                        
                            
<li >
    <a href="../audio/">Pi - Playing Music</a>
</li>

                        
                            
<li >
    <a href="../serial/">Pi - Working with Serial</a>
</li>

                        
                            
<li >
    <a href="../spi/">Pi - Debricking using SPI/JTAG board</a>
</li>

                        
                            
<li >
    <a href="../../qi/">Qi - Getting Started</a>
</li>

                        
                            
<li >
    <a href="../../qi/arduino-yun/">Qi - Using Arduino or Linino Firmware</a>
</li>

                        
                            
<li >
    <a href="../../qi/nodejs/">Qi - Using NodeJS and LininoIO</a>
</li>

                        
                            
<li >
    <a href="../../qi/serial/">Qi - Using Serial</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li>
                    <a href="https://docs.gl-inet.com/en/3/"><i class="fa fa-book"></i> Docs 3</a>
                </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#compile-the-firmware">Compile the firmware</a></li>
        
            <li><a href="#build-a-clean-openwrt-firmware-for-domino">Build a clean Openwrt firmware for Domino</a></li>
        
            <li><a href="#built-the-stock-firmware-with-domino-configurations">Built the stock firmware with Domino configurations</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="compile-the-firmware">Compile the firmware</h1>
<p>It is not difficult to compile your own OpenWrt firmware for Domino. Follow these instructions step by step.</p>
<h2 id="build-a-clean-openwrt-firmware-for-domino">Build a clean Openwrt firmware for Domino</h2>
<p>OpenWrt is a Linux distribution for embedded devices. You can find all the details of OpenWrt from http://openwrt.org
To compile an OpenWrt firmware for Domino, first you need to have a Linux environment. We will use Ubuntu as an example in this guide.</p>
<h3 id="1-build-environment">1. Build environment</h3>
<p>First install all the necessary packages:</p>
<pre><code>sudo apt-get update 
sudo apt-get install subversion build-essential git-core libncurses5-dev zlib1g-dev gawk flex quilt 
libssl-dev xsltproc libxml-parser-perl mercurial bzr ecj cvs unzip 
</code></pre>

<h3 id="2-configure-quilt">2. Configure quilt</h3>
<p>Please check http://wiki.openwrt.org/doc/devel/patches to understand how OpenWrt deal with patches. We will need to apply a patch to OpenWrt.</p>
<pre><code>cat &gt; ~/.quiltrc &lt;&lt;EOF
QUILT_DIFF_ARGS=&quot;--no-timestamps --no-index -p ab --color=auto&quot;
QUILT_REFRESH_ARGS=&quot;--no-timestamps --no-index -p ab&quot;
QUILT_PATCH_OPTS=&quot;--unified&quot;
QUILT_DIFF_OPTS=&quot;-p&quot;
EDITOR=&quot;nano&quot;
EOF
</code></pre>

<h3 id="3-download-openwrt-1407">3. Download OpenWrt 1407</h3>
<p>For domino-Pi, we use OpenWrt release BB1407.</p>
<pre><code>git clone git://git.openwrt.org/14.07/openwrt.git openwrt-domino
cd openwrt-domino
./scripts/feeds update -a
./scripts/feeds install -a
</code></pre>

<h3 id="3-alternative-download-openwrt-cc1505">3 (alternative). Download OpenWrt CC1505</h3>
<p>We upgrade the code to CC1505.</p>
<pre><code>https://github.com/domino-team/openwrt-cc.git
cd openwrt-cc
make menuconfig
</code></pre>

<p>You will find Domino in the "Target Profile". You can skip step 4 because the pateches are already installed.</p>
<h3 id="4-download-domino-sources-and-apply-domino-target-patch">4. Download Domino sources and apply Domino Target Patch</h3>
<p>If you are using OpenWrt BB1407 version, please apply the patches according to these instructions.</p>
<p>Download the Domino Target Patch from here: https://github.com/domino-team/domino-firmware/tree/master/domino-pi/openwrt-patch 
Put the patch files in openwrt-domino/patches.</p>
<pre><code>cd ..
git clone https://github.com/domino-team/domino-firmware.git 
cd openwrt-domino
mkdir patches
cp ../domino-firmware/domino-pi/openwrt/patches/domino.patch ./patches
cp ../domino-firmware/domino-pi/openwrt/patches/series ./patches
quilt push -a
rm ./tmp/*
./scripts/feeds install -a
</code></pre>

<p>Note that if the '-f' option is not specified, when make menuconfig is run, the Domino target will not appear.</p>
<h3 id="5-make-menuconfig">5. Make menuconfig</h3>
<p>Now you need to configure OpenWrt by choosing the correct target.</p>
<pre><code>make menuconfig
</code></pre>

<p><img alt="Menuconfig" src="https://static.gl-inet.com/docs/en/2.x/domino/pi/src/menuconfig.png" /></p>
<p>Select "Domino Wifi for things" in the "Target Profile". Exit and save the config file. Now you are ready to build the firmware.</p>
<pre><code>make 
</code></pre>

<p>If you want to use multithread, run <code>make -j x</code>, x is a number.</p>
<pre><code>make -j 5
</code></pre>

<p>You will probably encounter some errors and the compiling process will exit without showing you the details. You can run <code>make V=s</code> to show the details. Sometime it may be just a problem of downloading resources.</p>
<pre><code>make V=s
</code></pre>

<p>After make finishes, you will find the firmware in the bin folder. The correct one is: <code>openwrt-ar71xx-generic-domino-squashfs-sysupgrade.bin</code></p>
<pre><code>ls bin/ar71xx
</code></pre>

<p>Please note that you have built only a very basic firmware without a web UI, and with WiFi disabled. You might get flustrated that it doesn't work as you expected. Now read on to compile more packages.</p>
<h2 id="built-the-stock-firmware-with-domino-configurations">Built the stock firmware with Domino configurations</h2>
<h3 id="move-domino-sources-to-openwrt-tree">Move domino sources to OpenWrt tree</h3>
<p>If you want to build exactly the same firmware as pre-installed in Domino Pi, please copy the sources to openwrt tree, including athplay, domino-pi, iis, mpg123.
Put these packages in openwrt-domino/package/domino</p>
<pre><code>cd openwrt-domino
mkdir package/domino
cp -a ../domino-firmware/domino-pi/audio/* package/domino
cp -a ../domino-firmware/domino-pi/domino-pi package/domino
cp -a ../domino-firmware/domino-pi/mpg123 package/domino
mkdir files
cp -a ../domino-firmware/domino-pi//root-files/* files
</code></pre>

<p><img alt="Domino packages" src="https://static.gl-inet.com/docs/en/2.x/domino/pi/src/packages.png" /></p>
<p>Move the files in "root-files" to the "files" folder of openwrt. This is a quick and easy way to compile your default config to openwrt.</p>
<p><img alt="Domino root files" src="https://static.gl-inet.com/docs/en/2.x/domino/pi/src/rootfiles.png" /></p>
<h3 id="make-menuconfig">Make menuconfig</h3>
<p>Type <code>make menuconfig</code>, select 'domino' on the main menu (midway down), then select the Domino specific packages. These must be selected as compiled-in (*), not modules (M).</p>
<p><img alt="Domino packages" src="https://static.gl-inet.com/docs/en/2.x/domino/pi/src/menuconfig-domino.png" /></p>
<p>Select the packages by pressing the space key until it shows a '*' before the package name.</p>
<p>You will find "domino-athplay", "domino-pi" and "kmod-domino-iis" in "Domino" category. Select them all by pressing space key until it shows a * before the package. If you don't want audio, remove "domino-athplay" and "kmod-domino-iis" from the selction. If you want to play music, you also need to select "Utilities-&gt;mpg123". </p>
<p>That is all. You don't need to select any other packages because they are already selected automaticly.</p>
<h3 id="compile">compile</h3>
<p>Now compile the firmware by typing <code>make</code></p>
<pre><code>make
</code></pre>
<div id="disqus_thread"></div>
<script>

/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables */
/*
var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//glinet.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
                <p><a href='https://www.gl-inet.com/'> GL Technologies</a> 2019</p>
            
        </footer>

        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>var base_url = '../../..';</script>
        <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
        <script src="../../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
